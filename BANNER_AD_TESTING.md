# バナー広告機能のテスト手順

このドキュメントでは、実装したバナー広告機能のテスト方法について説明します。

## 前提条件

1. WordPress環境にプラグインがインストールされていること
2. 少なくとも1つのノベルゲームが作成されていること
3. Google AdSenseまたはAdsterraのアカウント（テスト用IDでも可）

## テスト手順

### 1. グローバル広告設定の確認

1. WordPress管理画面にログイン
2. **ノベルゲーム** → **📢 広告管理** に移動
3. Google AdSense または Adsterra の Publisher ID を入力（テスト用IDでも可）
4. 「広告設定を保存」をクリック

### 2. ゲームごと広告設定の確認

1. **ノベルゲーム** → **🎮 マイゲーム** に移動
2. テスト対象のゲームを選択
3. **広告設定** セクションで以下のいずれかを選択:
   - **広告を表示しない (none)**: デフォルト、広告は表示されない
   - **Google AdSense**: AdSense広告を表示
   - **Adsterra**: Adsterra広告を表示
4. 設定を保存

### 3. タイトル画面での広告非表示確認

1. ゲームアーカイブページまたはゲーム一覧ページにアクセス
2. テスト対象のゲームカードをクリック
3. モーダルウィンドウが開き、タイトル画面が表示されることを確認
4. **重要**: タイトル画面では広告が表示されないことを確認
   - 広告コンテナ(`#novel-ad-container`)が非表示(`display: none`)であることをブラウザの開発者ツールで確認

### 4. プレイ開始後の広告表示確認

1. タイトル画面で「最初から始める」または「続きから始める」をクリック
2. ゲームプレイ画面に遷移
3. **重要**: ゲーム画面上部に広告が表示されることを確認
   - 広告コンテナがゲームコンテナの最上部に配置されている
   - 広告がゲームUIと視覚的に区別できる（薄い背景色、境界線）
   - 広告の高さは60px〜100pxの範囲内

### 5. 広告プロバイダー別の確認

#### Google AdSense の場合
- `<ins class="adsbygoogle">` 要素が広告コンテナ内に存在することを確認
- AdSenseスクリプト(`pagead2.googlesyndication.com`)が非同期で読み込まれていることを確認
- コンソールに「AdSense 広告を初期化しました」というログが表示されることを確認

#### Adsterra の場合
- Adsterra の広告スクリプト(`topcreativeformat.com`)が広告コンテナ内に存在することを確認
- コンソールに「Adsterra 広告を表示しました」というログが表示されることを確認

### 6. 広告非表示条件の確認

以下の場合、広告が表示されないことを確認:

1. **広告プロバイダーが「none」の場合**
   - ゲーム設定で「広告を表示しない」を選択
   - プレイ開始後も広告が表示されない

2. **グローバルIDが未設定の場合**
   - 広告管理ページでPublisher IDを削除または空にする
   - プレイ開始後も広告が表示されない
   - コンソールに「広告設定がありません」というログが表示される

3. **既存ゲームの場合**
   - `noveltool_ad_provider` メタフィールドが未設定（または存在しない）
   - デフォルトで広告は表示されない

### 7. レスポンシブ対応の確認

以下のデバイス/画面サイズで正常に動作することを確認:

- デスクトップ（1920x1080以上）
- タブレット（768x1024）
- スマートフォン縦（375x667）
- スマートフォン横（667x375）

各サイズで以下を確認:
- 広告コンテナがゲーム画面幅いっぱいに表示される
- 広告がゲームUIと重ならない
- 広告の高さが適切（モバイルでは50px〜90px）

### 8. ブラウザ互換性の確認

以下のブラウザで正常に動作することを確認:

- Google Chrome（最新版）
- Mozilla Firefox（最新版）
- Safari（最新版）
- Microsoft Edge（最新版）

## デバッグ方法

### コンソールログの確認

ブラウザの開発者ツール（F12）を開き、コンソールタブで以下のログを確認:

```
広告設定を読み込みました: {provider: "adsense", publisherId: "ca-pub-xxx"}
Google AdSense 広告を初期化します
AdSense スクリプトの読み込みが完了しました
AdSense 広告を初期化しました
広告を初期化して表示しました
```

### デバッグモードの有効化

コンソールで以下を実行すると、より詳細なログが表示されます:

```javascript
window.novelGameSetDebug(true);
```

### DOM要素の確認

広告コンテナの状態を確認:

```javascript
// 広告コンテナの存在確認
$('#novel-ad-container').length  // 1であればOK

// 広告コンテナの表示状態
$('#novel-ad-container').css('display')  // タイトル画面: 'none', プレイ画面: 'flex'

// 広告コンテナの内容
$('#novel-ad-container').html()  // 広告スクリプトが挿入されているか確認
```

## 既知の制限事項

1. **広告スクリプトの読み込み時間**
   - 広告スクリプトは非同期で読み込まれるため、表示まで数秒かかる場合があります

2. **広告ブロッカー**
   - 広告ブロッカーが有効な場合、広告は表示されません
   - テスト時は広告ブロッカーを無効にしてください

3. **広告審査**
   - Google AdSenseの場合、アカウントが審査中または未承認の場合、広告が表示されないことがあります
   - テスト用IDを使用する場合は、実際の広告は表示されませんが、広告枠は表示されます

4. **クロスオリジン制限**
   - ローカル環境（localhost）では、一部の広告スクリプトが正常に動作しない場合があります
   - 本番環境またはステージング環境でテストすることを推奨します

## トラブルシューティング

### 広告が表示されない場合

1. グローバル広告設定（Publisher ID）が正しく保存されているか確認
2. ゲームごと広告設定が「none」以外に設定されているか確認
3. ブラウザのコンソールにエラーが表示されていないか確認
4. 広告ブロッカーが無効になっているか確認

### 広告がタイトル画面で表示される場合

1. `hideAdvertisement()` 関数が正しく呼び出されているか確認
2. CSS の `display: none` スタイルが適用されているか確認
3. `showTitleScreen()` 関数の最後で `hideAdvertisement()` が呼ばれているか確認

### 広告がプレイ画面で表示されない場合

1. `showAdvertisement()` 関数が正しく呼び出されているか確認
2. `initializeGameContent()` 関数の最後で `showAdvertisement()` が呼ばれているか確認
3. 広告設定データ（`adConfig`）が正しく読み込まれているか確認

## まとめ

このテスト手順に従って、バナー広告機能が正しく動作することを確認してください。問題が発生した場合は、デバッグ方法とトラブルシューティングセクションを参照してください。
