# サンプル画像ダウンロード機能 - テストチェックリスト

## テスト環境

- WordPress バージョン: _______
- PHP バージョン: _______
- テストサーバー: _______
- テスト実施日: _______
- テスト実施者: _______

## 前提条件

- [ ] プラグインがインストールされている
- [ ] プラグインが有効化されている
- [ ] `assets/sample-images` ディレクトリが存在しない状態である
- [ ] テストユーザーが管理者権限（`manage_options`）を持っている

## 機能テスト

### 1. 初回アクセス時のモーダル表示

**テスト手順:**
1. プラグインを有効化する
2. 「マイゲーム」画面にアクセスする

**期待される動作:**
- [ ] サンプル画像ダウンロードのモーダルが表示される
- [ ] モーダルのタイトルが「サンプル画像のダウンロード」である
- [ ] ダウンロードサイズ（約 15MB）が表示される
- [ ] 「ダウンロード」「後で」「キャンセル」ボタンが表示される
- [ ] モーダルが適切なスタイルで表示される（中央配置、オーバーレイ）

### 2. ダウンロード機能

**テスト手順:**
1. モーダルの「ダウンロード」ボタンをクリックする

**期待される動作:**
- [ ] ボタンが無効化される
- [ ] 「ダウンロード中...」メッセージが表示される
- [ ] スピナー（ローディングアニメーション）が表示される
- [ ] ダウンロードが完了するまで待機する（数分かかる可能性あり）

**ダウンロード成功時:**
- [ ] 「成功」メッセージが表示される
- [ ] 「閉じる」ボタンが表示される
- [ ] 「閉じる」ボタンをクリックするとページがリロードされる
- [ ] `assets/sample-images` ディレクトリが作成される
- [ ] サンプル画像ファイルが正しく配置される
- [ ] サンプルゲームが正常に表示される

### 3. ダウンロードのスキップ

**テスト手順:**
1. モーダルの「後で」または「キャンセル」ボタンをクリックする

**期待される動作:**
- [ ] モーダルが閉じる
- [ ] マイゲーム画面が通常通り表示される
- [ ] 次回アクセス時にモーダルが再度表示されない（`noveltool_sample_images_prompt_dismissed` が設定される）

### 4. エラーハンドリング

#### 4.1 ネットワークエラー

**テスト手順:**
1. ネットワークを切断する（またはファイアウォールでGitHubへのアクセスをブロック）
2. ダウンロードを試行する

**期待される動作:**
- [ ] エラーメッセージが表示される
- [ ] 「再試行」ボタンが表示される
- [ ] 「閉じる」ボタンが表示される
- [ ] 一時ファイルが適切にクリーンアップされる

#### 4.2 チェックサム検証エラー

**テスト手順:**
1. 破損したZIPファイルをダウンロードさせる（開発環境でのみ可能）

**期待される動作:**
- [ ] チェックサム検証エラーメッセージが表示される
- [ ] ダウンロードしたファイルが削除される
- [ ] 再試行オプションが提供される

### 5. 権限チェック

**テスト手順:**
1. 管理者以外のユーザー（編集者、投稿者など）でログインする
2. 「マイゲーム」画面にアクセスする

**期待される動作:**
- [ ] サンプル画像ダウンロードのモーダルが表示されない
- [ ] REST APIエンドポイントへの直接アクセスが拒否される（`manage_options` 権限が必要）

### 6. 既存の画像がある場合

**テスト手順:**
1. `assets/sample-images` ディレクトリが既に存在する状態にする
2. 「マイゲーム」画面にアクセスする

**期待される動作:**
- [ ] モーダルが表示されない
- [ ] サンプルゲームが正常に表示される

### 7. REST API エンドポイント

#### 7.1 ダウンロードエンドポイント

**テスト手順:**
```bash
curl -X POST \
  -H "X-WP-Nonce: YOUR_NONCE" \
  -H "Cookie: YOUR_ADMIN_COOKIE" \
  http://yoursite.com/wp-json/novel-game-plugin/v1/sample-images/download
```

**期待される動作:**
- [ ] 認証されたリクエストが成功する（200 OK）
- [ ] 認証されていないリクエストが拒否される（401 Unauthorized）
- [ ] レスポンスに適切なメッセージが含まれる

#### 7.2 ステータスエンドポイント

**テスト手順:**
```bash
curl -X GET \
  -H "X-WP-Nonce: YOUR_NONCE" \
  -H "Cookie: YOUR_ADMIN_COOKIE" \
  http://yoursite.com/wp-json/novel-game-plugin/v1/sample-images/status
```

**期待される動作:**
- [ ] 現在の状態が正しく返される
- [ ] `exists` フィールドが正確である
- [ ] `status` フィールドが正確である（`not_started`, `in_progress`, `completed`, `failed`）

## レスポンシブテスト

### モバイル表示

**テスト手順:**
1. モバイルデバイス（または開発者ツールのモバイルモード）で「マイゲーム」画面にアクセスする

**期待される動作:**
- [ ] モーダルが適切にリサイズされる
- [ ] ボタンが縦に配置される
- [ ] テキストが読みやすい
- [ ] スクロール可能である

### タブレット表示

**テスト手順:**
1. タブレットサイズの画面で「マイゲーム」画面にアクセスする

**期待される動作:**
- [ ] モーダルが適切に表示される
- [ ] UIが使いやすい

## ブラウザ互換性テスト

- [ ] Chrome/Edge: 正常に動作する
- [ ] Firefox: 正常に動作する
- [ ] Safari: 正常に動作する
- [ ] モバイルブラウザ: 正常に動作する

## パフォーマンステスト

**テスト手順:**
1. ダウンロード処理の実行時間を計測する

**期待される動作:**
- [ ] タイムアウトが発生しない（5分以内）
- [ ] メモリ使用量が適切である
- [ ] サーバーに過度な負荷をかけない

## セキュリティテスト

### 権限チェック

- [ ] 管理者以外のユーザーがダウンロードを実行できない
- [ ] REST APIエンドポイントが適切に保護されている
- [ ] Nonce検証が正しく機能する

### ファイルシステム

- [ ] ダウンロードしたファイルが適切な場所に保存される
- [ ] 一時ファイルが適切にクリーンアップされる
- [ ] ディレクトリトラバーサル攻撃から保護されている

## 国際化テスト

**テスト手順:**
1. WordPress の言語を日本語に設定する
2. 機能をテストする

**期待される動作:**
- [ ] すべてのメッセージが日本語で表示される
- [ ] 翻訳が正確である
- [ ] 文字エンコーディングが正しい

## 回帰テスト

**テスト手順:**
1. サンプルゲームの既存機能を確認する

**期待される動作:**
- [ ] サンプルゲームのインストール機能が正常に動作する
- [ ] サンプルゲームのプレイが正常に動作する
- [ ] 他のプラグイン機能に影響がない

## テスト結果まとめ

### 成功したテスト
- 

### 失敗したテスト
- 

### 発見された問題
1. 
2. 
3. 

### 改善提案
1. 
2. 
3. 

## 承認

- [ ] すべての重要なテストが合格した
- [ ] 発見された問題が修正された、または受け入れ可能である
- [ ] 本番環境へのデプロイ準備が整っている

**承認者:** _________________
**承認日:** _________________
