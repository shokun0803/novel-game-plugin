# テストガイド: 条件で内容変更モードの仕様見直し

このドキュメントは、「条件で内容変更」モードの仕様変更に関する手動テスト手順を記載しています。

## 前提条件

- WordPress環境が用意されていること
- Novel Game Pluginがインストール・有効化されていること
- テスト用のゲームとシーンが作成できる状態であること

## テスト環境のセットアップ

### 1. テスト用ゲームの作成

1. 管理画面「ノベルゲーム」→「ゲーム設定」にアクセス
2. 「新規ゲーム追加」で以下の情報を入力：
   - ゲームタイトル: `条件テスト用ゲーム`
   - ゲーム概要: `条件付きセリフのテスト用`

### 2. フラグの設定

1. 作成したゲームの「編集」をクリック
2. 「フラグ管理」セクションで以下のフラグを追加：
   - フラグ名: `test_flag_1`, 説明: `テスト用フラグ1`
   - フラグ名: `test_flag_2`, 説明: `テスト用フラグ2`

### 3. テストシーンの作成

#### シーン1: フラグ設定シーン
- タイトル: `フラグ設定シーン`
- ゲームタイトル: `条件テスト用ゲーム`
- セリフ: `これからフラグをONにします`
- 選択肢:
  - テキスト: `次へ（フラグON）`
  - 次のシーン: `条件テストシーン`
  - フラグ設定: `test_flag_1` をON

#### シーン2: 条件テストシーン
- タイトル: `条件テストシーン`
- ゲームタイトル: `条件テスト用ゲーム`
- セリフ1:
  - 通常テキスト: `フラグがOFFの場合のセリフです`
  - 表示制御: `条件成立時に内容変更（代替テキスト表示）`
  - フラグ条件: `test_flag_1` = ON
  - 条件ロジック: `AND`
  - 代替テキスト: `フラグがONになりました！`
- セリフ2:
  - 通常テキスト: `これは普通のセリフです`
  - 表示制御: `通常表示`

## テストケース

### テストケース1: 新挙動（互換モード無効）

#### 準備
1. 管理画面「ノベルゲーム」→「ゲーム設定」
2. 「互換性設定」セクション
3. 「旧挙動を使用する」のチェックを**外す**
4. 「互換性設定を保存」をクリック

#### 手順
1. フロントエンドで「条件テスト用ゲーム」を開始
2. 最初のシーン（フラグ設定シーン）が表示される
3. 「次へ（フラグON）」を選択
4. 条件テストシーンに移動

#### 期待される結果
- ✅ セリフ1: `フラグがONになりました！`（代替テキストが表示される）
- ✅ セリフ2: `これは普通のセリフです`（通常表示は影響なし）

### テストケース2: 旧挙動（互換モード有効）

#### 準備
1. 管理画面「ノベルゲーム」→「ゲーム設定」
2. 「互換性設定」セクション
3. 「旧挙動を使用する」に**チェックを入れる**
4. 「互換性設定を保存」をクリック

#### 手順
テストケース1と同じ手順を実行

#### 期待される結果
- ✅ セリフ1: `フラグがOFFの場合のセリフです`（通常テキストが表示される）
- ✅ セリフ2: `これは普通のセリフです`（通常表示は影響なし）

### テストケース3: 代替テキスト未入力時のフォールバック

#### 準備
1. 「条件テストシーン」を編集
2. セリフ1の代替テキストを**空にする**
3. 保存

#### 手順
1. 互換モードを**無効**にする
2. テストケース1と同じ手順を実行

#### 期待される結果
- ✅ セリフ1: `フラグがOFFの場合のセリフです`（代替テキストが空なので通常テキストをフォールバック）

### テストケース4: 条件不成立の場合

#### 準備
1. 新しいシーンを作成：「フラグなしテストシーン」
2. セリフ設定はテストケース1と同じ
3. 「フラグ設定シーン」の選択肢を追加：
   - テキスト: `次へ（フラグなし）`
   - 次のシーン: `フラグなしテストシーン`
   - フラグ設定: なし

#### 手順
1. フロントエンドで「条件テスト用ゲーム」を開始
2. 「次へ（フラグなし）」を選択
3. フラグなしテストシーンに移動

#### 期待される結果（新挙動・旧挙動共通）
- ✅ セリフ1: `フラグがOFFの場合のセリフです`（条件不成立なので通常テキスト）

### テストケース5: 複数条件 AND

#### 準備
1. 「条件テストシーン」を編集
2. セリフ1のフラグ条件に `test_flag_2` = ON を追加
3. 条件ロジック: `AND`
4. 「フラグ設定シーン」の選択肢で `test_flag_1` と `test_flag_2` の両方をON

#### 手順
テストケース1と同じ手順を実行

#### 期待される結果（新挙動）
- ✅ セリフ1: `フラグがONになりました！`（両方のフラグがONなので条件成立）

### テストケース6: 複数条件 OR

#### 準備
1. 「条件テストシーン」を編集
2. セリフ1の条件ロジックを `OR` に変更
3. 「フラグ設定シーン」の選択肢で `test_flag_1` のみON

#### 手順
テストケース1と同じ手順を実行

#### 期待される結果（新挙動）
- ✅ セリフ1: `フラグがONになりました！`（いずれかのフラグがONなので条件成立）

### テストケース7: 「条件で非表示」モードの回帰確認

#### 準備
1. 「条件テストシーン」を編集
2. 新しいセリフを追加：
   - 通常テキスト: `フラグがONの時は非表示になります`
   - 表示制御: `条件成立時に非表示`
   - フラグ条件: `test_flag_1` = ON

#### 手順
1. フラグONの状態でシーンを表示
2. フラグOFFの状態でシーンを表示

#### 期待される結果
- フラグONの場合: セリフが**非表示**
- フラグOFFの場合: セリフが**表示**される

## チェックリスト

実装完了後、以下の項目を確認してください：

- [ ] 新挙動: 条件成立時に代替テキストが表示される
- [ ] 新挙動: 代替テキストが空の場合、通常テキストがフォールバックとして表示される
- [ ] 新挙動: 条件不成立時に通常テキストが表示される
- [ ] 旧挙動: 条件成立時に通常テキストが表示される
- [ ] 旧挙動: 条件不成立時に代替テキストが表示される
- [ ] 複数条件 AND が正しく評価される
- [ ] 複数条件 OR が正しく評価される
- [ ] 「条件で非表示」モードが正常に動作する（回帰なし）
- [ ] 「通常表示」モードが正常に動作する（回帰なし）
- [ ] 管理画面でUI文言が正しく表示される
- [ ] 互換モード設定が保存・読み込みできる
- [ ] 既存インストールでは自動的に互換モードが有効になる

## トラブルシューティング

### 代替テキストが表示されない

1. ブラウザのコンソールを開く（F12キー）
2. `window.novelGameSetDebug(true)` を実行してデバッグモードを有効化
3. ゲームをプレイして、コンソールログを確認
4. フラグの状態と条件評価結果を確認

### 互換モード設定が反映されない

1. ブラウザのキャッシュをクリア
2. WordPress のキャッシュをクリア（キャッシュプラグインを使用している場合）
3. ページをリロードしてゲームを再開

### フラグが正しく設定されない

1. ブラウザのコンソールで `window.novelGameShowFlags()` を実行
2. 現在のフラグ状態を確認
3. フラグ名のスペルミスや大文字小文字の違いを確認

## 報告方法

バグや問題を発見した場合は、以下の情報を含めて報告してください：

- WordPress バージョン
- プラグインバージョン
- ブラウザとバージョン
- 再現手順
- 期待される結果と実際の結果
- スクリーンショットやコンソールログ（可能であれば）

報告先: [GitHub Issues](https://github.com/shokun0803/novel-game-plugin/issues)
