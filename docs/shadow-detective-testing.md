# 「影の探偵」ゲーム テスト手順書

## 概要

本ドキュメントは、「影の探偵」（Shadow Detective）本格推理ゲームのテスト手順と確認項目をまとめたものです。

## テスト環境

- WordPress 4.7以上
- PHP 7.0以上
- Novel Game Plugin 1.3.0以上

## インストールテスト

### 手順1: プラグイン有効化テスト

1. WordPressプラグイン管理画面で Novel Game Plugin を有効化
2. 自動的にサンプルゲームがインストールされることを確認
3. 管理画面「ノベルゲーム管理」→「マイゲーム」に「Shadow Detective」が表示されることを確認

### 手順2: シーン数確認

1. 「マイゲーム」で「Shadow Detective」を選択
2. シーン一覧タブで、23シーンすべてが作成されていることを確認

**期待される結果:**
- シーン1: Shadow Detective - The Beginning
- シーン2: Shadow Detective - Details of Disappearance
- シーン3: Shadow Detective - Warehouse District
- ...（中略）...
- シーン21: Shadow Detective - Complete Solution
- シーン22: Shadow Detective - Partial Solution
- シーン23: Shadow Detective - Insufficient Evidence

### 手順3: フラグマスタ確認

1. 「ゲーム設定」タブを開く
2. フラグマスタに以下10個のフラグが登録されていることを確認

**期待されるフラグ:**
- flag_item_watch (Pocket Watch)
- flag_item_note (Missing Person's Diary)
- flag_item_photo (Evidence Photo)
- flag_item_key (Hidden Room Key)
- flag_item_trade_memo (Illicit Transaction Memo)
- flag_talked_wife (Talked to Wife)
- flag_talked_friend (Talked to Friend)
- flag_found_hidden_room (Discovered Hidden Room)
- flag_met_underworld (Contacted Underworld)
- flag_confronted_mastermind (Confronted Mastermind)

## 機能テスト

### テストケース1: 完全解決エンド到達テスト

**目的:** すべての証拠を集めて完全解決エンディングに到達できることを確認

**手順:**
1. シーン1からゲームを開始
2. 以下のルートでプレイ
   - シーン1 → シーン2 → シーン3（懐中時計入手）
   - シーン4 → シーン5（妻との会話）→ シーン6（証拠写真入手）
   - シーン7 → シーン8（手記入手）→ シーン9
   - シーン10（鍵入手）→ シーン13（金庫開ける）
   - シーン14（闇取引メモ入手）→ シーン16
   - シーン18（証拠提示）→ シーン19 → シーン20
   - シーン21（完全解決エンド）

**期待される結果:**
- 各シーンで対応するフラグが正しく設定される
- シーン21で「Complete Solution - All truths have been revealed」が表示される
- ゲームオーバーやバッドエンドにならない

### テストケース2: 部分解決エンド到達テスト

**目的:** 一部証拠を取りこぼした場合に部分解決エンディングに到達することを確認

**手順:**
1. シーン1からゲームを開始
2. 以下のルートでプレイ（鍵を取得しないルート）
   - シーン1 → シーン2 → シーン3（懐中時計入手）
   - シーン4 → シーン6（証拠写真入手）→ シーン11 → シーン12
   - シーン15 → シーン17 → シーン22（部分解決エンド）

**期待される結果:**
- flag_item_key が取得されていない
- シーン22で「Partial Solution - Some truths remain in darkness」が表示される

### テストケース3: 証拠不足エンド到達テスト

**目的:** 重要証拠なしで進行した場合に証拠不足エンディングに到達することを確認

**手順:**
1. シーン1からゲームを開始
2. 証拠をほとんど取得せずに進行
   - シーン1 → シーン2 → シーン4（懐中時計を取らない）
   - シーン5 → シーン7 → シーン9（手記も取らない）
   - シーン11 → シーン12 → シーン15 → シーン17
   - シーン23（証拠不足エンド）

**期待される結果:**
- シーン23で「Insufficient Evidence - Detective Failure」が表示される

### テストケース4: フラグ条件分岐テスト

**目的:** 選択肢の required_flags が正しく動作することを確認

**手順:**
1. シーン16まで進行
2. flag_item_trade_memo を取得していない状態でシーン16の選択肢を確認

**期待される結果:**
- 「Explain this illicit transaction memo」選択肢が無効化されている、または選択できない
- flag_item_trade_memo 取得後は選択可能になる

### テストケース5: フラグ設定テスト

**目的:** 各シーンで正しくフラグが設定されることを確認

**手順:**
1. ブラウザの開発者ツール（Console）を開く
2. ゲームプレイ中に各シーンでフラグを確認
   ```javascript
   novelGameShowFlags()
   ```

**期待される結果:**
- シーン3通過後: flag_item_watch = 1
- シーン6通過後: flag_item_photo = 1, flag_talked_friend = 1
- シーン8通過後: flag_item_note = 1
- シーン10通過後: flag_item_key = 1, flag_found_hidden_room = 1
- シーン14通過後: flag_item_trade_memo = 1

## UI/表示テスト

### テストケース6: エンディング文言表示テスト

**目的:** 各エンディングで正しい文言が表示されることを確認

**手順:**
1. 各エンディングに到達
2. エンディング画面の表示を確認

**期待される結果:**
- 完全解決エンド: 「Complete Solution - All truths have been revealed」
- 部分解決エンド: 「Partial Solution - Some truths remain in darkness」
- 証拠不足エンド: 「Insufficient Evidence - Detective Failure」

### テストケース7: レスポンシブ表示テスト

**目的:** モバイル・デスクトップで正しく表示されることを確認

**手順:**
1. デスクトップブラウザでゲームをプレイ
2. ブラウザ幅を縮小（モバイル幅）
3. 実際のモバイルデバイスでテスト

**期待される結果:**
- 背景画像が正しく表示される
- キャラクター画像が適切に配置される
- セリフテキストが読みやすい
- 選択肢ボタンがタップしやすい

### テストケース8: キャラクター表示テスト

**目的:** 各シーンで正しいキャラクターが表示されることを確認

**チェック項目:**
- シーン1: 中央に依頼者
- シーン5: 左に美咲
- シーン6: 右に佐藤
- シーン11: 右に情報屋
- シーン12: 中央に龍組幹部
- シーン18-19: 中央に高木社長
- シーン20: 中央に黒崎誠
- シーン21: 左に美咲、右に黒崎誠

## 国際化テスト

### テストケース9: 日本語環境テスト

**目的:** 日本語環境で正しく表示されることを確認

**手順:**
1. WordPressの言語設定を「日本語」に設定
2. プラグインを再インストール
3. Shadow Detectiveをプレイ

**期待される結果:**
- すべてのテキストが日本語で表示される
- エンディング文言も日本語で表示される

### テストケース10: 英語環境テスト

**目的:** 英語環境で正しく表示されることを確認

**手順:**
1. WordPressの言語設定を「English」に設定
2. プラグインを再インストール
3. Shadow Detectiveをプレイ

**期待される結果:**
- すべてのテキストが英語で表示される
- エンディング文言も英語で表示される

### テストケース11: 翻訳ファイル確認

**目的:** 翻訳ファイルに必要な文字列が含まれることを確認

**手順:**
1. languages/novel-game-plugin.pot ファイルを開く
2. 以下の文字列が含まれることを確認
   - "Shadow Detective"
   - "Complete Solution"
   - "Partial Solution"
   - "Insufficient Evidence"
   - "Pocket Watch"
   - "Missing Person's Diary"
   - など

**期待される結果:**
- すべての翻訳可能文字列が.potファイルに含まれている

## データ整合性テスト

### テストケース12: シーン削除・再インストールテスト

**目的:** ゲーム削除後の再インストールが正常に動作することを確認

**手順:**
1. Shadow Detectiveのすべてのシーンを削除
2. 管理画面からサンプルゲーム再インストール機能を実行
3. シーンが正しく再作成されることを確認

**期待される結果:**
- 23シーンすべてが再作成される
- フラグマスタも再作成される
- データの重複や欠落がない

### テストケース13: 選択肢リンク整合性テスト

**目的:** すべての選択肢が有効なシーンにリンクしていることを確認

**手順:**
1. 各シーンの選択肢を確認
2. 選択肢をクリックして次のシーンに正しく遷移することを確認

**期待される結果:**
- すべての選択肢が有効なシーンIDを参照している
- 存在しないシーンへのリンクがない
- 404エラーが発生しない

### テストケース14: 大量データパフォーマンステスト

**目的:** 23シーン構成でもパフォーマンス問題がないことを確認

**手順:**
1. Shadow Detectiveを最初から最後までプレイ
2. ページロード時間を計測
3. ブラウザのメモリ使用量を確認

**期待される結果:**
- 各シーンのロード時間が3秒以内
- メモリリークが発生しない
- ブラウザがクラッシュしない

## セキュリティテスト

### テストケース15: 権限チェックテスト

**目的:** 管理者権限以外でサンプルインストールが実行できないことを確認

**手順:**
1. 管理者以外のユーザーでログイン（編集者など）
2. サンプルゲームインストール用のAJAXエンドポイントに直接アクセス

**期待される結果:**
- 権限エラーが返される
- サンプルゲームがインストールされない

### テストケース16: データサニタイズテスト

**目的:** 投稿メタの保存時にサニタイズが適切に行われることを確認

**手順:**
1. シーンメタデータに悪意のあるスクリプトを含めようとする
2. データベースに保存されたデータを確認

**期待される結果:**
- スクリプトタグがエスケープまたは削除される
- XSS攻撃が防止される

## リグレッションテスト

### テストケース17: 既存ゲーム影響確認

**目的:** Shadow Detective追加が既存ゲームに影響しないことを確認

**手順:**
1. 既存のサンプルゲーム（Sample Novel Game）をプレイ
2. 正常に動作することを確認

**期待される結果:**
- Sample Novel Gameが正常にプレイできる
- Shadow Detectiveとの干渉がない

### テストケース18: プラグイン無効化・有効化テスト

**目的:** プラグインの無効化・再有効化でデータが破損しないことを確認

**手順:**
1. プラグインを無効化
2. プラグインを再有効化
3. Shadow Detectiveが正常にプレイできることを確認

**期待される結果:**
- データが保持される
- フラグマスタが保持される
- ゲーム進行状態（localStorage）が保持される

## 自動化テスト候補

### ユニットテスト案

以下のロジックはユニットテストでの自動化が推奨されます：

1. **フラグ設定テスト**
   ```php
   test_flag_setting_in_scene_3()
   test_flag_setting_in_scene_10()
   ```

2. **エンディング判定テスト**
   ```php
   test_complete_solution_ending_conditions()
   test_partial_solution_ending_conditions()
   test_insufficient_evidence_ending_conditions()
   ```

3. **選択肢条件分岐テスト**
   ```php
   test_required_flags_validation()
   test_choice_availability_with_flags()
   ```

### 統合テスト案

以下は統合テストでの自動化が推奨されます：

1. **ゲームインストールテスト**
   ```php
   test_shadow_detective_installation()
   test_scene_creation()
   test_flag_master_creation()
   ```

2. **シーン遷移テスト**
   ```php
   test_scene_navigation()
   test_choice_navigation()
   test_ending_navigation()
   ```

## テスト結果記録テンプレート

### テスト実施記録

| テストケース | 実施日 | 実施者 | 結果 | 備考 |
|------------|--------|--------|------|------|
| TC1: 完全解決エンド | YYYY-MM-DD | 名前 | ✓/✗ | |
| TC2: 部分解決エンド | YYYY-MM-DD | 名前 | ✓/✗ | |
| TC3: 証拠不足エンド | YYYY-MM-DD | 名前 | ✓/✗ | |
| ... | ... | ... | ... | |

### 不具合報告テンプレート

**タイトル:** [不具合の概要]

**再現手順:**
1. 
2. 
3. 

**期待される動作:**


**実際の動作:**


**環境:**
- WordPress バージョン:
- PHP バージョン:
- ブラウザ:
- デバイス:

**スクリーンショット:**
（任意）

---

## まとめ

本テスト手順書に従ってテストを実施することで、「影の探偵」ゲームの品質を確保できます。
すべてのテストケースが成功することを確認してから、本番環境へのデプロイを行ってください。
