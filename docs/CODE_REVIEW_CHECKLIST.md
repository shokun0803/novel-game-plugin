# コードレビューチェックリスト

本ドキュメントは、Novel Game Plugin のコードレビュー時に確認すべき項目をまとめたものです。
プルリクエストのレビュー時に、このチェックリストを活用してください。

## 目次
1. [一般的なチェック項目](#一般的なチェック項目)
2. [命名規約](#命名規約)
3. [コーディング規約](#コーディング規約)
4. [セキュリティ](#セキュリティ)
5. [パフォーマンス](#パフォーマンス)
6. [国際化（i18n）](#国際化i18n)
7. [ドキュメント](#ドキュメント)
8. [テスト](#テスト)

---

## 一般的なチェック項目

### コード品質
- [ ] コードは読みやすく、理解しやすいか
- [ ] 適切なコメントが記述されているか（日本語）
- [ ] 不要なコード（デバッグ用のコンソール出力等）が削除されているか
- [ ] コードの重複がないか（DRY原則）
- [ ] 関数やクラスが適切な責任範囲を持っているか（単一責任原則）

### 互換性
- [ ] 既存の機能を損なっていないか
- [ ] 後方互換性が保たれているか
- [ ] WordPress のバージョン要件（4.7+）を満たしているか
- [ ] PHP のバージョン要件（7.0+）を満たしているか

---

## 命名規約

詳細は [NAMING_CONVENTIONS.md](./NAMING_CONVENTIONS.md) を参照してください。

### PHP
- [ ] すべての関数に `noveltool_` プレフィックスが付いているか
- [ ] 関数名・変数名が snake_case になっているか
- [ ] クラス名が `Noveltool_` プレフィックス付きの PascalCase になっているか
- [ ] 定数名がすべて大文字の snake_case で `NOVELTOOL_` プレフィックスが付いているか
- [ ] カスタムフィールドキーがアンダースコア始まりの snake_case になっているか

### JavaScript
- [ ] ローカル関数名が lowerCamelCase になっているか（プレフィックスなし）
- [ ] グローバル関数名に `noveltool_` プレフィックスが付いているか（使用は避けるべき）
- [ ] 変数名が lowerCamelCase になっているか
- [ ] 文字列キー（オブジェクトプロパティ）が lowerCamelCase になっているか
- [ ] 定数名がすべて大文字の snake_case になっているか
- [ ] jQuery オブジェクト変数に `$` プレフィックスが付いているか

### CSS
- [ ] クラス名が `noveltool-` プレフィックス付きの kebab-case になっているか
- [ ] ID名が `novel-` プレフィックス付きの kebab-case になっているか
- [ ] `!important` の使用を避けているか

### WordPress 固有
- [ ] フック名が `noveltool_` プレフィックス付きの snake_case になっているか
- [ ] ショートコード名が適切なプレフィックス付きの snake_case になっているか
- [ ] オプション名が `noveltool_` プレフィックス付きの snake_case になっているか

---

## コーディング規約

### WordPress コーディング規約準拠
- [ ] [WordPress PHP Coding Standards](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/php/) に準拠しているか
- [ ] [WordPress JavaScript Coding Standards](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/javascript/) に準拠しているか
- [ ] [WordPress CSS Coding Standards](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/css/) に準拠しているか

### PHP
- [ ] インデントはスペース4つになっているか
- [ ] 波括弧 `{` の位置は関数宣言の次の行になっているか
- [ ] 適切な PHPDoc コメントが付いているか（`@param`, `@return`, `@since` 等）
- [ ] `<?php` タグの直後に空白行がないか
- [ ] ファイル末尾に不要な空白行や `?>` タグがないか

### JavaScript
- [ ] インデントはタブになっているか
- [ ] `use strict;` が適切に使用されているか
- [ ] jQuery のラッパー関数内でコードが実行されているか
- [ ] セミコロンが適切に使用されているか

### CSS
- [ ] インデントはタブになっているか
- [ ] プロパティの順序が整理されているか
- [ ] ベンダープレフィックスが必要な場合に付いているか

---

## セキュリティ

### 入力検証とサニタイゼーション
- [ ] すべてのユーザー入力が適切にサニタイズされているか
  - `sanitize_text_field()`, `sanitize_textarea_field()`, `sanitize_email()` 等
- [ ] ファイル名が `sanitize_file_name()` でサニタイズされているか
- [ ] URL が `esc_url()` または `sanitize_url()` で処理されているか

### 出力エスケープ
- [ ] すべての出力が適切にエスケープされているか
  - `esc_html()`, `esc_attr()`, `esc_url()`, `esc_js()` 等
- [ ] 翻訳関数と組み合わせる場合、`esc_html__()`, `esc_attr__()` 等を使用しているか

### データベースセキュリティ
- [ ] SQL クエリに `$wpdb->prepare()` を使用しているか
- [ ] 直接の SQL インジェクションの可能性がないか
- [ ] プレースホルダー（`%s`, `%d`, `%f`）が適切に使用されているか

### 認証と認可
- [ ] 管理画面の処理に権限チェック（`current_user_can()`）があるか
- [ ] nonce フィールドが生成され、検証されているか
  - `wp_nonce_field()`, `wp_verify_nonce()`, `check_ajax_referer()` 等
- [ ] Ajax リクエストに適切なセキュリティチェックがあるか

### ファイルアクセス制御
- [ ] 直接アクセスを防ぐコード（`if ( ! defined( 'ABSPATH' ) ) { exit; }`）があるか
- [ ] アップロードファイルの検証（拡張子、MIME タイプ、サイズ）があるか

---

## パフォーマンス

### データベース
- [ ] 不要なクエリが実行されていないか
- [ ] N+1 問題が発生していないか
- [ ] 適切なインデックスが使用されているか
- [ ] `posts_per_page => -1` の使用が本当に必要か検討されているか

### JavaScript
- [ ] DOM 操作が最小限に抑えられているか
- [ ] イベントリスナーが適切にバインド・アンバインドされているか
- [ ] `setTimeout` や動的 DOM 再取得の多用を避けているか
- [ ] Ajax リクエストが適切に最適化されているか

### CSS
- [ ] セレクタが過度に複雑でないか
- [ ] 不要な `!important` が使用されていないか
- [ ] メディアクエリが適切に使用されているか

### キャッシュ
- [ ] 必要に応じてトランジェント API が使用されているか
- [ ] オブジェクトキャッシュが適切に活用されているか

---

## 国際化（i18n）

### 翻訳関数の使用
- [ ] すべての表示テキストに翻訳関数（`__()`, `_e()`, `_x()` 等）が使用されているか
- [ ] テキストドメイン `'novel-game-plugin'` が正しく指定されているか
- [ ] JavaScript でも `wp.i18n` の `__()` が使用されているか

### 翻訳対象テキスト
- [ ] エラーメッセージが翻訳可能になっているか
- [ ] 管理画面のラベル・説明文が翻訳可能になっているか
- [ ] フロントエンドの表示テキストが翻訳可能になっているか

### 文脈の提供
- [ ] 曖昧なテキストには `_x()` で文脈が提供されているか
- [ ] 複数形の処理に `_n()` が使用されているか

---

## ドキュメント

### コード内ドキュメント
- [ ] すべてのコメントが日本語で記述されているか
- [ ] 関数・クラスに PHPDoc コメントが付いているか
  - `@package`, `@since`, `@param`, `@return` 等
- [ ] 複雑なロジックに説明コメントが付いているか

### 外部ドキュメント
- [ ] README.md に変更内容が反映されているか
- [ ] 必要に応じて docs/ ディレクトリにドキュメントが追加されているか
- [ ] API の変更がドキュメント化されているか

### プルリクエスト
- [ ] PR の説明が日本語で書かれているか
- [ ] 変更内容が明確に説明されているか
- [ ] 関連する Issue が参照されているか
- [ ] スクリーンショット（UI 変更の場合）が含まれているか

---

## テスト

### 動作確認
- [ ] 変更内容が意図通りに動作するか
- [ ] 既存の機能が正常に動作するか
- [ ] エラーが発生しないか
- [ ] 様々な環境（ブラウザ、デバイス）で動作するか

### エッジケース
- [ ] 空の入力値でエラーが発生しないか
- [ ] 予期しない形式の入力が適切に処理されるか
- [ ] データが存在しない場合の処理が適切か

### WordPress 環境
- [ ] マルチサイト環境で動作するか（該当する場合）
- [ ] 他のプラグイン・テーマとの競合がないか
- [ ] WordPress のデバッグモードで警告・エラーが出ないか

---

## リポジトリ運用規約

### ブランチ運用
- [ ] PR の base ブランチが `dev` になっているか（`master` 直は禁止）
- [ ] 適切なブランチ名が使用されているか（`feature/`, `fix/`, `chore/` 等）
- [ ] PR が base: `dev` で作成されているか

### コミットメッセージ
- [ ] コミットメッセージが日本語で記述されているか
- [ ] コミットメッセージが変更内容を明確に説明しているか
- [ ] 一度作成した PR のタイトル・概要が変更されていないか

### Git 操作
- [ ] `git push --force` が使用されていないか（明示的な指示がある場合を除く）
- [ ] 不要なファイル（ビルド成果物、依存関係等）がコミットされていないか
- [ ] `.gitignore` が適切に設定されているか

---

## ライセンスとクレジット

### ライセンス
- [ ] すべてのコードが GPLv2 互換ライセンスに準拠しているか
- [ ] サードパーティのライブラリ・コードのライセンスが互換性があるか
- [ ] 必要なライセンス表示が含まれているか

### 著作権
- [ ] 他者のコードを使用する場合、適切なクレジットが記載されているか
- [ ] 著作権侵害の可能性がないか

---

## レビュー後のアクション

### 承認前
- [ ] すべてのチェック項目が確認されたか
- [ ] 指摘事項が解決されたか
- [ ] CI/CD（存在する場合）がパスしているか

### 承認後
- [ ] マージ方法が適切か（`--no-ff` 推奨）
- [ ] マージ後に不要なブランチが削除されているか
- [ ] 次のフェーズへの準備が整っているか

---

## 参考資料

- [命名規約ガイドライン](./NAMING_CONVENTIONS.md)
- [WordPress コーディング規約](https://developer.wordpress.org/coding-standards/wordpress-coding-standards/)
- [リポジトリ運用規約](../.github/copilot-instructions.md)
- [WordPress プラグインディレクトリ登録ガイドライン](https://developer.wordpress.org/plugins/wordpress-org/detailed-plugin-guidelines/)

---

## 更新履歴

- **1.0.0** (2025-10-14): 初版作成 - Phase 3 命名規約統一作業の一環として策定
